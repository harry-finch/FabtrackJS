<!doctype html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="" />
        <meta name="author" content="StÃ©phane Muller" />
        <title>Fabtrack administration panel</title>

        <% include ../includes/pagehead.html %>
    </head>

    <body class="d-flex justify-content-center bg-body-tertiary py-4">
        <% include ../includes/light-dark.html %>

        <main class="w-50 mx-auto">
            <% include ../includes/header.html %>

            <h4 class="mb-4"><i class="fa fa-user-pen"></i>&nbsp;&nbsp;Edit user profile</h4>
            <form action="/users/update/<%= user.id %>" method="post">
                <div class="row">
                    <div class="col-4">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>" required />
                            <label for="name">Name</label>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="surname" name="surname" value="<%= user.surname %>" required />
                            <label for="surname">Surname</label>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="birthyear" name="birthyear" value="<%= user.birthYear %>" />
                            <label for="birthyear">Birth year</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="form-floating mb-3">
                            <input type="email" name="email" class="form-control" id="email" value="<%= user.mail %>" required /><%= user.email %>
                            <label for="email">Email address</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-floating mb-3">
                            <select class="form-select" id="usertype" name="usertype">
                                <% usertypes.forEach(function(usertype) { %>
                                <option value="<%= usertype.id %>" <% if (usertype.id == user.usertypeId) { %> selected <% } %>><%= usertype.name %></option>
                                <% }); %>
                            </select>
                            <label for="usertype">Type of user</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="comments" name="comments" style="height: 100px"><%= user.comment %></textarea>
                            <label for="comments">Comments</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button class="btn btn-primary w-100 mb-2 py-2" type="submit">Update user profile</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <a class="btn btn-secondary w-100 mb-2 py-2" onclick="history.back();">Cancel</a>
                    </div>
                </div>
            </form>

            <hr class="mt-4 mb-4">

            <div class="accordion mb-4" id="accordionExample">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <b><i class="fa fa-triangle-exclamation"></i>&nbsp;&nbsp;Warnings</b>
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                  <div class="accordion-body">
                      <% if (warnings.length > 0) { %>
                      <h5 class="mb-4"><i class="fa-solid fa-siren-on"></i>&nbsp;&nbsp;Pending</h5>

                      <table class="mb-5 table">
                          <thead>
                              <tr>
                                  <th scope="col">#</th>
                                  <th scope="col">Warning type</th>
                                  <th scope="col">Created</th>
                                  <th scope="col">Comments</th>
                                  <th scope="col" class="text-center">Resolve</th>
                              </tr>
                          </thead>
                          <tbody id="table-content">
                              <% warnings.forEach(function(warning) { %>
                              <tr>
                                  <td scope="row"><%= warning.id %></td>
                                  <td><%= warning.warningtype.name %></td>
                                  <td><%= warning.createdAt %></td>
                                  <td><%= warning.comments %></td>
                                  <td class="text-center">
                                      <a href="warning/deactivate/<%= warning.id %>"><i class="fa-solid fa-circle-xmark"></i></a>
                                  </td>
                              </tr>
                              <% }); %>
                          </tbody>
                      </table>
                      <% } %>

                      <h5 class="mt-4 mb-4">
                          <i class="fa fa-triangle-exclamation"></i>&nbsp;&nbsp;Add a warning
                      </h5>
                      <form action="/warning/create" method="post">
                          <div class="row">
                              <input type='hidden' id="userid" name='userid' value='<%= user.id %>' />
                              <div class="col-12">
                                  <div class="form-floating mb-3">
                                      <select class="form-select" id="warningtype" name="warningtype">
                                          <% warningtypes.forEach(function(warningtype) { %>
                                          <option value="<%= warningtype.id %>"><%= warningtype.name %></option>
                                          <% }); %>
                                      </select>
                                      <label for="warningtype">Type of warning</label>
                                  </div>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-12">
                                  <div class="form-floating mb-3">
                                      <textarea class="form-control" id="comments" name="comments" style="height: 100px"></textarea>
                                      <label for="comments">Comments</label>
                                  </div>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-12">
                                  <button class="btn btn-primary w-100 mb-2 py-2" type="submit">Add a warning</button>
                              </div>
                          </div>
                      </form>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                      <b><i class="fa fa-clipboard-list"></i>&nbsp;&nbsp;History</b>
                    </button>
                  </h2>
                  <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Arrival</th>
                                    <th scope="col" class="text-center">Departure</th>
                                    <% if (selectedWorkspace) { %>
                                    <th scope="col" class="text-center">Workspace</th>
                                    <% } %>
                                    <th scope="col" class="text-center">Project</th>
                                    <th scope="col" class="text-center">Comments</th>
                                </tr>
                            </thead>
                            <tbody id="table-content">
                                <% history.forEach(function(entry) { %>
                                <tr>
                                    <td scope="row"><%= entry.arrival %></td>
                                    <td scope="row" class="text-center"><%= entry.departure %></td>
                                    <% if (selectedWorkspace) { %>
                                    <td scope="row" class="text-center"><% if(entry.workspace){ %><%= entry.workspace.name %><% } else { %>-<% } %></td>
                                    <% } %>
                                    <td scope="row" class="text-center"><a href="<%= entry.project.url %>"><i class="fa-solid fa-book"></i></a></td>
                                    <td class="text-center">
                                        <% if ( entry.comments ) { %>
                                            <span   data-bs-toggle="tooltip" data-bs-placement="top"
                                                        data-bs-custom-class="custom-tooltip"
                                                        data-bs-title="<%= entry.comments %>"><i class="fa-solid fa-comment-lines"></i></span>
                                        <% } else { %>
                                        <i class="fa-regular fa-comment" style="color: grey"></i>
                                        <% } %>
                                    </td>
                                </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                  </div>
                </div>
            </div>

        <% include ../includes/footer.html %>
    </body>
</html>
